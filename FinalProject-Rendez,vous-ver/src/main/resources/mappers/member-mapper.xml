<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//myvatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberMapper">
	<resultMap type="Member" id="memberResultSet">
		<id property="user_no" column="USER_NO"/>
		<result property="user_id" column="USER_ID"/>
		<result property="user_pwd" column="USER_PWD"/>
		<result property="user_name" column="USER_NAME"/>
		<result property="gender" column="GENDER"/>
		<result property="age" column="AGE"/>
		<result property="phone" column="PHONE"/>
		<result property="address" column="ADDRESS"/>
		<result property="photo" column="PHOTO"/>
		<result property="upphoto" column="UPPHOTO"/>
		<result property="enroll_date" column="ENROLL_DATE"/>
		<result property="update_date" column="UPDATE_DATE"/>
		<result property="user_type" column="USER_TYPE"/>
		<result property="u_status" column="U_STATUS"/>
	</resultMap>
	<!-- 리뷰리스트 -->
	<resultMap type="ReviewList" id="reviewListSet">
		<id property="lNo" column="L_NO"/>
		<result  property="userNo" column="USER_NO"/>
		<result property="lTitle" column="L_TITLE"/>
		<result property="rContent" column="REVIEW_CONTENT"/>
		<result property="rDate" column="REVIEW_DATE"/>
	</resultMap>
	<!-- 유저프로필 -->
	<resultMap type="Userpropic" id="userpropicResultSet">

		<id property="uNo" column="USER_NO"/>
		<result property="uOriginName" column="U_O_NAME"/>
		<result property="uChangeName" column="U_C_NAME"/>
		
	</resultMap>
	
	<select id="loginCheck" resultType="int">
			SELECT count(*) FROM member
			WHERE user_id = #{user_id} AND user_pwd = #{user_pwd}
	</select>
	
	<select id="selectOne" resultType="member" parameterType="member">
		SELECT *
		FROM MEMBER
		WHERE USER_ID = #{user_id}
		AND U_STATUS = 'Y'
	</select>
	
	<insert id="insertMember" parameterType="Member">
	  INSERT ALL
      INTO
      MEMBER 
      VALUES (SEQ_MNO.NEXTVAL, #{user_id}, #{user_pwd}, #{user_name}, #{gender}, #{age}, #{phone}, #{address}, SYSDATE, SYSDATE, DEFAULT, DEFAULT)
      INTO
      USERPROPIC
      VALUES(SEQ_MNO.CURRVAL,'default.jpg','default.jpg')
      SELECT *
      from dual	
	</insert>
	
	<select id="idCheck" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE USER_ID=#{user_id}
	</select>
	
	<update id="deleteMember" parameterType="Member">
		UPDATE MEMBER
		SET U_STATUS = 'N'
		WHERE USER_ID = #{user_id}
	</update>
	
	<update id="updateMember" parameterType="Member">
		UPDATE MEMBER
		SET USER_NAME = #{user_name},
			USER_PWD = #{user_pwd},
			GENDER = #{gender},
			AGE = #{age},
			PHONE = #{phone},
			ADDRESS = #{address},
			UPDATE_DATE = SYSDATE
		WHERE USER_ID = #{user_id}
	</update>
	
	<select id="selectReviewList" resultMap="reviewListSet">
		SELECT *
		FROM REVIEW_LIST
		WHERE USER_NO = #{userNo}
	</select>

	<select id="userpropic" resultMap="userpropicResultSet" parameterType="Userpropic">
		select *
		from member
		join userpropic using(user_no)
		where user_no=${value}
	</select>

</mapper>